<div class="activity_controller">
    <%if current_user.groupid == nil %>
        <h1 class="pagetitle">Your Activities</h1>
    <% else %>
        <h1 class="pagetitle">Activities for <%=@group.name%></h1>
        <link rel="stylesheet" href="/usr/local/rvm/gems/ruby-2.4.0/gems/bootstrap-4.1.3/assets/stylesheets/bootstrap/mixins/_grid-framework.scss">
    <% end %>
    <br>
    <div class="activitycontainer col-sm-12">
        <% if @acts.blank? %>
            <H2 class="emptyerror">There are no stored activities!</H2>
            <br>
            <%if current_user.groupid == nil %>
                <H3>Add an activity or join a group to see activities here.</H3>
            <%else%>
                <H3>Activities will appear here when you or someone in your group adds one.</H3>
            <%end%>
        <% else %>
            <center>
                <div class="input-group mb-3 justify-content-center">
                    <input type="text" id="activitySearchInput" class="searchBar" onkeyup="activitySearch()" placeholder="Search for an entry..." title="Search here">
                    <div class="input-group-append">
                        <select id='activitySearchSelect' class='selectBar' onchange="activitySearch()">
                            <option>Activity Type</option>
                            <option>Duration</option>
                            <option>Person Who Done It</option>
                        </select>
                    </div>
                </div>
            </center>
            
            
            
            <div class="container col-md-12">
                
              <table id="activitytable" class="table table-hover table-bordered table-condensed">
                <thead class="thead-light">
                  <tr>
                    <th><p class="link"><a class="UP" onclick="sortActivityTableByColumn(0,true)" href="javascript:void(0);">Activity Type</a></p></th>
                    <th><p class="link"><a class="UP" onclick="sortActivityTableByColumn(1)" href=javascript:void(0);>Duration (Minutes)</a></p></th>
                    <th><p class="link"><a class="UP" onclick="sortActivityTableByColumn(2)" href=javascript:void(0);>Person Who Done It</a></p></th>
                    <th><p class="link"><a class="UP" onclick="sortActivityTableByTime()" href=javascript:void(0);>Entry Time</a></p></th>
                    <th><p class="link"><a onclick="sortActivityTableByTime()" href=javascript:void(0);>Entry Date</a></p></th>
                  </tr>
                </thead>
                
                <tbody>
                    <% @n = 0 %>
                    <% @acts.each do |act| %>
                        <% @n = @n+1 %>
                        <% unless @n > 25 %>
                            <% if act.userid == current_user.id %>
                                <tr class = "table-primary">
                            <% else %>
                                <tr class="table-info">
                            <% end %>
                        <% else %>
                            <% if act.userid == current_user.id %>
                                <tr class = "table-primary" style="display: none;">
                            <% else %>
                                <tr class="table-info" style="display: none;">
                            <% end %>
                        <% end %>
                            <td><p class="name"><%= link_to act.name, {:action => 'show', :id => act.id} %></p></td>
                            <td><p class="duration"><%= act.duration %></p></td>
                            <td><p class="user"><%= act.userName %></p></td>
                            <td><%= content_tag :p, :id => act.created_at, :class => "timestamp" do %> 
                                    <%= act.created_at.in_time_zone("Central Time (US & Canada)").strftime("%H:%M") %> 
                                <% end %>
                            </p></td>
                            <td><p class="timestamp"><%= act.created_at.in_time_zone("Central Time (US & Canada)").strftime("%a, %m/%d/%y") %></p></td>
                        </tr>
                    <% end %>
                </tbody>
              </table>
            </div>
            <br>
            <ul id="pageLinks" class="pagination justify-content-center">
                <% @pages = (@n/25).ceil %>
                <% (1..@pages).each do |i| %>
                    <% if i == 1 %>
                        <li class="page-item active">
                    <% else %>
                        <li class="page-item">
                    <% end %>
                    <%= content_tag :a, :class => "page-link", :href =>"javascript:void(0)", :onclick => "setActivityTableRows("+i.to_s+",25)" do %>
                        <%= i %>&nbsp
                    <% end %>
                    </li>
                <% end %>
            </ul>
            <br>
            </table>
        <% end %>
    </div>
</div>
<div class="gradient-buttons text-center">
    <button type="button" class="btn btn-large btn-primary" data-toggle="modal" data-target="#newActivityModal">Log New Activity</button>
</div>
<div id="newActivityModal" class="modal fade">
    <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h4 class="modal-title">Modal Heading</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <div class="modal-body">
            <% if current_user.groupid == nil %>
                <p class="warn">
                    You are currently not a member of any group. Activities that you 
                    log now will not be available to you once you join a group.
                </p>
                <br>
            <% end %>
            <%= form_tag onsubmit="submitNewActivity()" do %>
                <div class='activitypanel'>
                    <div class="activity_feature">
                        <p><label for = "activity_type">Select Activity Type: </label></p>
                        <%= collection_select(:activities, :actid, @act_types, :id, :name)%>
                    </div>
                    <div class="activity_feature">
                        <p><label for = "activity_duration">Enter Activity Duration in Minutes: </label></p>
                        <%= number_field 'activities', 'duration', :required => true, :step=>'any' %>
                    </div>
                    <br>
                    <br>
                    <div class="activity_feature">
                        <p><label for = "activity_user">Activity will be recorded under the name of <%= current_user.first_name %> <%= current_user.last_name %></label></p>
                        <%= hidden_field :activities, :userid, :value => current_user.id %>
                    </div>
                    <br>
                </div>
                <br>
                <div class="gradient-buttons">
                    <button type="submit" onclick="submitNewActivity()" data-dismiss="modal" class='btn center-block btn-lg btn-primary'>Log Data</Button>
                </div>
            <% end%>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>